<div class="mb-3 d-flex justify-content-between">
  <h3>Servicios</h3>
  <button class="btn btn-success btn-sm" (click)="addService()">
    <i class="bi bi-plus-circle"></i> Nuevo Servicio
  </button>
</div>

<div class="accordion" id="accordionServices">
  @for (service of array.controls; track $index) {
    <div class="accordion-item" [formGroup]="asGroup(service)">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapseSv'+$index">
          {{ service.value.title || 'Nuevo Servicio' }}
        </button>
      </h2>
      <div [id]="'collapseSv'+$index" class="accordion-collapse collapse" data-bs-parent="#accordionServices">
        <div class="accordion-body">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Título</label>
              <input type="text" class="form-control" formControlName="title">
            </div>
            <div class="col-md-6">
              <label class="form-label">Subtítulo</label>
              <input type="text" class="form-control" formControlName="sub-title">
            </div>
            <div class="col-12">
                <label class="form-label">Descripción</label>
                <textarea class="form-control" rows="3" formControlName="description"></textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label">Imagen URL</label>
              <input type="text" class="form-control" formControlName="Imagen">
              @if(asGroup(service).get('Imagen')?.value) {
                <img [src]="asGroup(service).get('Imagen')?.value.replace('dl=0','raw=1')" class="img-thumbnail mt-2" style="max-height: 100px">
              }
            </div>
              <div class="col-md-6">
              <label class="form-label">Icono (Bootstrap Class)</label>
              <input type="text" class="form-control" formControlName="icono">
            </div>
          </div>

          <div class="mt-4 border-top pt-3">
            <div class="d-flex justify-content-between mb-2">
                <h6>Videos</h6>
                <button class="btn btn-outline-primary btn-sm" (click)="addVideo(asGroup(service))">
                  <i class="bi bi-film"></i> + Video
                </button>
            </div>

            @let videosArray = getVideosArray(asGroup(service));

            @for (video of videosArray.controls; track $index; let vIndex = $index) {
              <div class="input-group mb-2" [formGroup]="asGroup(video)">
                <span class="input-group-text">URL</span>
                <input type="text" class="form-control" formControlName="url">
                <button class="btn btn-outline-danger" (click)="removeVideo(asGroup(service), vIndex)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            }
          </div>

          <div class="mt-3 text-end">
            <button class="btn btn-danger btn-sm" (click)="removeService($index)">
              Eliminar este servicio
            </button>
          </div>

        </div>
      </div>
    </div>
  }
</div>
