<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Portafolio de Proyectos</h3>
  <button class="btn btn-success btn-sm" (click)="addProject()">
    <i class="bi bi-folder-plus"></i> Nuevo Proyecto
  </button>
</div>

<div class="accordion" id="accordionProjects">
  @for (project of array.controls; track $index) {
    <div class="accordion-item" [formGroup]="asGroup(project)">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapsePr'+$index">
          <i class="bi bi-folder me-2"></i> {{ project.value.title || 'Nuevo Proyecto' }}
        </button>
      </h2>
      <div [id]="'collapsePr'+$index" class="accordion-collapse collapse" data-bs-parent="#accordionProjects">
        <div class="accordion-body">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre del Cliente/Proyecto</label>
              <input type="text" class="form-control" formControlName="title">
            </div>
            <div class="col-md-6">
              <label class="form-label">Subtítulo</label>
              <input type="text" class="form-control" formControlName="sub-title">
            </div>
            <div class="col-12">
                <label class="form-label">Descripción del Caso</label>
                <textarea class="form-control" rows="4" formControlName="description"></textarea>
            </div>
            <div class="col-12">
              <label class="form-label">Imagen/Logo URL</label>
              <div class="input-group">
                <input type="text" class="form-control" formControlName="iconUrl">
                @if(project.get('iconUrl')?.value) {
                  <span class="input-group-text p-0 overflow-hidden" style="width:50px">
                    <img [src]="project.get('iconUrl')?.value.replace('dl=0','raw=1')" class="w-100 h-100 object-fit-cover">
                  </span>
                }
              </div>
            </div>
          </div>

          <div class="bg-light p-3 rounded mt-3">
            <div class="d-flex justify-content-between mb-2">
                <h6 class="mb-0">Galería de Videos</h6>
                <button class="btn btn-outline-secondary btn-sm" (click)="addVideo(asGroup(project))">
                  <i class="bi bi-camera-video"></i> Agregar URL
                </button>
            </div>

            @let videosArray = getVideosArray(asGroup(project));

            @if (videosArray.controls.length === 0) {
              <p class="text-muted small fst-italic">No hay videos agregados.</p>
            }

            @for (video of videosArray.controls; track $index; let vIndex = $index) {
              <div class="input-group mb-2" [formGroup]="asGroup(video)">
                <span class="input-group-text"><i class="bi bi-youtube"></i></span>
                <input type="text" class="form-control form-control-sm" formControlName="url" placeholder="https://...">
                <button class="btn btn-outline-danger btn-sm" (click)="removeVideo(asGroup(project), vIndex)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            }
          </div>

          <div class="mt-3 text-end border-top pt-2">
            <button class="btn btn-danger btn-sm" (click)="removeProject($index)">
              <i class="bi bi-trash-fill"></i> Eliminar Proyecto
            </button>
          </div>

        </div>
      </div>
    </div>
  }
</div>
